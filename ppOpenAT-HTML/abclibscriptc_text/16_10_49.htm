
<html>
<head>
<title>OutputUnroll_Line_Fortran メンバ関数説明</title><base target="main">
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="stylesheet">
<meta http-equiv="Content-Type" content="text/html;charset=Shift_JIS">
</head>

<body bgcolor="#ffffff">

<div align="right"><font size="2">ABCLibScriptC プロジェクト</font></div>

<table width=100% bgcolor="#e6e6fa" class="titlebgcolor" border="1" cellpadding="7" cellspacing="0">
<tr>
    <td><font class="titlefont">14.10.49. OutputUnroll_Line_Fortran メンバ関数説明</font></td>
</tr>
</table>

<p></p>
<table border="1">
<tr><th align="left" nowrap>メンバ関数名</th>  <td nowrap>OutputUnroll_Line_Fortran</td></tr>
<tr><th align="left" nowrap>定義ファイル名</th><td nowrap>TuneRegion.cpp</td></tr>
<tr><th align="left" nowrap>定義行</th>        <td nowrap>9354</td></tr>
<tr><th align="left" nowrap>所属名</th>        <td nowrap>TTuneRegion</td></tr>
<tr><th align="left" nowrap>アクセス属性</th>  <td nowrap>public</td></tr>
<tr><th align="left" nowrap>宣言形式</th>      <td nowrap>int OutputUnroll_Line_Fortran ( FILE * fp , int TokPos , unsigned int UseDoRefValBits , int RefValIdx )</td></tr>
<tr><th align="left" nowrap>概要</th>          <td nowrap>多重化したコードを１行出力する。<br>UseDoRefValBitsとRefValIdxによるDo参照変数部分の置換を行った行を出力する。<br>RefValIdxは、Countに対しての番号となる。（呼び出し側から指定される）<br>ここから、別の解析を呼ぶことはない。<br>最後のトークン（通常はtid_LineEnd)の位置を返す。</td></tr>
<tr><th align="left" nowrap>戻り値</th>        <td nowrap></td></tr>
<tr><th align="left" nowrap>パラメタ説明</th>  <td nowrap>fp  出力先ファイルポインタ<br>TokPos  トークン位置<br>UseDoRefValBits 使用中ＤＯ参照変数Ｂｉｔｓ<br>RefValIdx   参照変数インデックス</td></tr>
<tr><th align="left" nowrap>機能説明</th>      <td nowrap></td></tr>
<tr><th align="left" nowrap>備考</th>          <td nowrap></td></tr>
</table>

<p></p>
呼出し元関数一覧表
<table border="1">
<tr>
<th nowrap>№</th>
<th nowrap>名称</th>
<th nowrap>定義ファイル名</th>
<th nowrap>定義行</th>
</tr>
<tr>
<td nowrap>1</td>
<td nowrap><a href="16_10_45.htm">TTuneRegion::OutputUnroll_DoBlock_Fortran</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_45.htm">9728</a></td>
</tr>
<tr>
<td nowrap>2</td>
<td nowrap><a href="16_10_47.htm">TTuneRegion::OutputUnroll_IfBlock_Fortran</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_47.htm">10802</a></td>
</tr>
<tr>
<td nowrap>3</td>
<td nowrap><a href="16_10_51.htm">TTuneRegion::OutputUnrollExecCode_Fortran</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_51.htm">8599</a></td>
</tr>
</table>

<p></p>
呼出し先関数一覧表
<table border="1">
<tr>
<th nowrap>№</th>
<th nowrap>名称</th>
<th nowrap>定義ファイル名</th>
<th nowrap>定義行</th>
</tr>
<tr>
<td nowrap>1</td>
<td nowrap><a href="16_10_6.htm">TTuneRegion::ChangeFromOrgStr</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_6.htm">11408</a></td>
</tr>
<tr>
<td nowrap>2</td>
<td nowrap><a href="16_10_10.htm">TTuneRegion::GetBitIdx</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_10.htm">11287</a></td>
</tr>
<tr>
<td nowrap>3</td>
<td nowrap><a href="16_10_11.htm">TTuneRegion::GetDoValAddValue</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_11.htm">11455</a></td>
</tr>
<tr>
<td nowrap>4</td>
<td nowrap><a href="16_10_13.htm">TTuneRegion::GetNewValName</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_13.htm">11089</a></td>
</tr>
<tr>
<td nowrap>5</td>
<td nowrap><a href="16_10_14.htm">TTuneRegion::GetNewValName</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_14.htm">11245</a></td>
</tr>
<tr>
<td nowrap>6</td>
<td nowrap><a href="16_10_21.htm">TTuneRegion::GetValAddValue</a></td>
<td nowrap><a href="5_7.htm">TuneRegion.cpp</a></td>
<td nowrap><a href="16_10_21.htm">11508</a></td>
</tr>
<tr>
<td nowrap>7</td>
<td nowrap><a href="31_21.htm">SepLongStr</a></td>
<td nowrap><a href="5_4.htm">pass3.cpp</a></td>
<td nowrap><a href="31_21.htm">950</a></td>
</tr>
<tr>
<td nowrap>8</td>
<td nowrap>IntToStr</td>
<td nowrap><a href="5_16.htm">VCL_Lib.h</a></td>
<td nowrap>107</td>
</tr>
<tr>
<td nowrap>9</td>
<td nowrap>c_str</td>
<td nowrap><br></td>
<td nowrap><br></td>
</tr>
<tr>
<td nowrap>10</td>
<td nowrap>find</td>
<td nowrap><br></td>
<td nowrap><br></td>
</tr>
<tr>
<td nowrap>11</td>
<td nowrap>fprintf</td>
<td nowrap><br></td>
<td nowrap><br></td>
</tr>
</table>

<p></p>

<p></p>
参照メンバ変数一覧表
<table border="1">
<tr>
<th nowrap>№</th>
<th nowrap>名称</th>
<th nowrap>定義ファイル名</th>
<th nowrap>定義行</th>
</tr>
<tr>
<td nowrap>1</td>
<td nowrap>TTuneRegion::ArgValList</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>207</td>
</tr>
<tr>
<td nowrap>2</td>
<td nowrap>TTuneRegion::DoValIdx</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>159</td>
</tr>
<tr>
<td nowrap>3</td>
<td nowrap>TTuneRegion::DoValName</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>158</td>
</tr>
<tr>
<td nowrap>4</td>
<td nowrap>TTuneRegion::OffsetStr</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>214</td>
</tr>
<tr>
<td nowrap>5</td>
<td nowrap>TTuneRegion::TokenEndPos</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>190</td>
</tr>
<tr>
<td nowrap>6</td>
<td nowrap>TTuneRegion::TokenList</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>187</td>
</tr>
<tr>
<td nowrap>7</td>
<td nowrap>TTuneRegion::UnrollCount</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>151</td>
</tr>
<tr>
<td nowrap>8</td>
<td nowrap>TTuneRegion::UnRollDoRefValBits</td>
<td nowrap><a href="5_15.htm">TuneRegion.h</a></td>
<td nowrap>149</td>
</tr>
</table>

<p></p>
参照先一覧表
<table border="1">
<tr>
<th nowrap>№</th>
<th nowrap>名称</th>
<th nowrap>種別</th>
<th nowrap>定義ファイル名</th>
<th nowrap>定義行</th>
</tr>
<tr>
<td nowrap>1</td>
<td nowrap><a href="16_9_1.htm">TToken</a></td>
<td nowrap>クラス</td>
<td nowrap><a href="5_10.htm">pass1.h</a></td>
<td nowrap><a href="16_9_1.htm">294</a></td>
</tr>
<tr>
<td nowrap>2</td>
<td nowrap><a href="16_11_1.htm">TValData</a></td>
<td nowrap>クラス</td>
<td nowrap><a href="5_11.htm">pass2.h</a></td>
<td nowrap><a href="16_11_1.htm">106</a></td>
</tr>
</table>

<p></p>
<pre>
関数論理チャート

        |  +------------------------------------------------------------------------------------------------------------+ 
  9354  +--+ int TTuneRegion::OutputUnroll_Line_Fortran(FILE *fp,int TokPos,unsigned int UseDoRefValBits,int RefValIdx) | 
  9355     | {                                                                                                          | 
           +--+---------------------------------------------------------------------------------------------------------+ 
  9356        +--- string s;
  9357        +--- int Idx;
  9358        +--- int AddValue;   // 変数への加算数
  9359        +--- TValData *ValData;
  9360        +--- TToken *Token,*TokenB,*TokenF;
  9361        +--- int j;
  9362        +--- string OprCheckStr = &quot;(),&quot;;
  9363        +--- string NewValName;
  9364        |    
  9365        +--- s = &quot;&quot;;
              |  +----------------------------------------------------------------+ 
  9366        +--+ if(UseDoRefValBits == 0){ // UnRollなしの場合は、そのまま出力  | 
              |  +--+-------------------------------------------------------------+ 
              |     |  +------------------------------------------+ 
  9367        |     +--+ for( ; TokPos &lt; TokenEndPos ; TokPos++){ | 
              |     |  +--+---------------------------------------+ 
  9368        |     |     +--- Token = (TToken *)TokenList-&gt;Items[TokPos];
  9369        |     |     +--- s += Token-&gt;OrgStr;
              |     |     |  +----------------------------------+ 
  9370        |     |     +--+ if(Token-&gt;TokId == tid_LineEnd){ | 
              |     |     |  +--+-------------------------------+ 
              |     |     |     |  +--------+ 
  9371        |     |     |     +--+ break; | 
              |     |     |     |  +--------+ 
              |     |     |   +-+---+ 
  9372        |     |     |   |  }  | 
              |     |     |   +-----+ 
              |     |   +-+---+ 
  9373        |     |   |  }  | 
              |     |   +-----+ 
              |     |  +--------------------------------+ 
  9374        |     +--+ if((s != &quot;&quot;)&amp;&amp;(s[1] == ' ')){  | 
              |     |  +--+-----------------------------+ 
  9375        |     |     +--- s = OffsetStr + s;
              |     |   +-+---+ 
  9376        |     |   |  }  | 
              |     |   +-----+ 
  9377        |     +--- s = SepLongStr(s);
  9378        |     +--- fprintf(fp,&quot;%s&quot;,s.c_str());
              |     |  +----------------+ 
  9379        |     +--+ return TokPos; | 
              |     |  +----------------+ 
              |   +-+---+ 
  9380        |   |  }  | 
              |   +-----+ 
  9381        +--- //
  9382        |    // DO依存変数または、Do変数を含んだ式！  
  9383        |    // 変数部分の置換を行う                  
  9384        |    //                                       
              |  +----------------------------------------------------------------+ 
  9385        +--+ for(j = TokPos ; j &lt; TokenEndPos ; j++){ // 行の先頭から、最後 | 
              |  +--+-------------------------------------------------------------+ 
  9386        |     +--- Token = (TToken *)TokenList-&gt;Items[j];
              |     |  +----------------------------------+ 
  9387        |     +--+ if(Token-&gt;TokId == tid_LineEnd){ | 
              |     |  +--+-------------------------------+ 
  9388        |     |     +--- TokPos = j;
              |     |     |  +--------+ 
  9389        |     |     +--+ break; | 
              |     |     |  +--------+ 
              |     |   +-+---+ 
  9390        |     |   |  }  | 
              |     |   +-----+ 
  9391        |     +--- ValData = (TValData *)Token-&gt;ValData;
              |     |  +----------------------+ 
  9392        |     +--+ if(ValData != NULL){ | 
              |     |  +--+-------------------+ 
              |     |     |  +------------------------------+ 
  9393        |     |     +--+ if(ValData-&gt;DoValBits != 0){ | 
              |     |     |  +--+---------------------------+ 
  9394        |     |     |     +--- //
  9395        |     |     |     |    // DO変数の置き換え                                  
  9396        |     |     |     |    // 前後が オペレータでなければ、()を付けない。       
  9397        |     |     |     |    // 加算する値は、UnrollCount[] と kk によって決まる  
  9398        |     |     |     |    //                                                   
  9399        |     |     |     +--- Idx = GetBitIdx(ValData-&gt;DoValBits);
  9400        |     |     |     +--- TokenB = (TToken *)TokenList-&gt;Items[j-1];
  9401        |     |     |     +--- TokenF = (TToken *)TokenList-&gt;Items[j+1];
  9402        |     |     |     |    
  9403        |     |     |     +--- //      fprintf(fp,&quot;AddValue %s[RefValIdx=%d:DoValBits %04X] DoValIdx = %d UnRollBits = %04X \n&quot;,ValData-&gt;Str.c_str(),
  9404        |     |     |     |    //          RefValIdx,ValData-&gt;DoValBits,DoValIdx,UnRollDoRefValBits);                                                 
  9405        |     |     |     |                                                                                                                           
  9406        |     |     |     +--- AddValue = GetDoValAddValue(RefValIdx,
  9407        |     |     |     |                    ValData-&gt;DoValBits &amp; UnRollDoRefValBits, 
  9408        |     |     |     |                    DoValIdx,UnrollCount);                   
              |     |     |     |  +--------------------+ 
  9409        |     |     |     +--+ if(AddValue == 0){ | 
              |     |     |     |  +--+-----------------+ 
  9410        |     |     |     |     +--- s += ChangeFromOrgStr(Token-&gt;OrgStr,&quot;&quot;);
  9411        |     |     |     |     +--- s += DoValName[Idx];
              |     |     |     |   +-+---+ 
  9412        |     |     |     |   |  }  | 
              |     |     |     |   +-+---+ 
              |     |     |     |   +-+-----------------------------------------------------------+ 
  9412        |     |     |     |   |  else if((OprCheckStr.find(TokenB-&gt;Str) != string::npos)&amp;&amp;  | 
  9413        |     |     |     |   |         (OprCheckStr.find(TokenF-&gt;Str) != string::npos)){   | 
              |     |     |     |   +-+-----------------------------------------------------------+ 
  9414        |     |     |     |     +--- s += ChangeFromOrgStr(Token-&gt;OrgStr,&quot;&quot;);
  9415        |     |     |     |     +--- s += DoValName[Idx] + &quot;+&quot; + IntToStr(AddValue);
              |     |     |     |   +-+---+ 
  9416        |     |     |     |   |  }  | 
              |     |     |     |   +-+---+ 
              |     |     |     |   +-+-------+ 
  9416        |     |     |     |   |  else{  | 
              |     |     |     |   +-+-------+ 
  9417        |     |     |     |     +--- s += ChangeFromOrgStr(Token-&gt;OrgStr,&quot;&quot;);
  9418        |     |     |     |     +--- s += &quot;(&quot;+DoValName[Idx] + &quot;+&quot;+ IntToStr(AddValue)+&quot;)&quot;;
              |     |     |     |   +-+---+ 
  9419        |     |     |     |   |  }  | 
              |     |     |     |   +-----+ 
              |     |     |   +-+---+ 
  9420        |     |     |   |  }  | 
              |     |     |   +-+---+ 
              |     |     |   +-+-------------------------------------------------------------+ 
  9420        |     |     |   |  else if(((ValData-&gt;RefDoValBits &amp; UnRollDoRefValBits) != 0)  | 
  9421        |     |     |   |             &amp;&amp;(ValData-&gt;ArrayLevel == 0)){                    | 
              |     |     |   +-+-------------------------------------------------------------+ 
  9422        |     |     |     +--- //
  9423        |     |     |     |    // Do依存変数の置き換え                                
  9424        |     |     |     |    // ・配列は、対象外とする。(Doの変数が含まれると想定)  
  9425        |     |     |     |    // ・Do依存変数のAddValueを求める（Idx)                
  9426        |     |     |     |    //                                                     
  9427        |     |     |     +--- AddValue = GetValAddValue(RefValIdx,
  9428        |     |     |     |                    ValData-&gt;RefDoValBits &amp; UnRollDoRefValBits,  
  9429        |     |     |     |                    DoValIdx,UnrollCount);                       
              |     |     |     |  +--------------------+ 
  9430        |     |     |     +--+ if(AddValue == 0){ | 
              |     |     |     |  +--+-----------------+ 
  9431        |     |     |     |     +--- NewValName = ValData-&gt;Str;
              |     |     |     |   +-+---+ 
  9432        |     |     |     |   |  }  | 
              |     |     |     |   +-+---+ 
              |     |     |     |   +-+-------+ 
  9432        |     |     |     |   |  else{  | 
              |     |     |     |   +-+-------+ 
  9433        |     |     |     |     +--- NewValName = GetNewValName(ValData-&gt;Str,AddValue+1,ArgValList);
              |     |     |     |   +-+---+ 
  9434        |     |     |     |   |  }  | 
              |     |     |     |   +-----+ 
  9435        |     |     |     +--- s += ChangeFromOrgStr(Token-&gt;OrgStr,NewValName);
              |     |     |   +-+---+ 
  9436        |     |     |   |  }  | 
              |     |     |   +-+---+ 
              |     |     |   +-+-------+ 
  9436        |     |     |   |  else{  | 
              |     |     |   +-+-------+ 
  9437        |     |     |     +--- s += Token-&gt;OrgStr;
              |     |     |   +-+---+ 
  9438        |     |     |   |  }  | 
              |     |     |   +-----+ 
              |     |   +-+---+ 
  9439        |     |   |  }  | 
              |     |   +-+---+ 
              |     |   +-+-------+ 
  9439        |     |   |  else{  | 
              |     |   +-+-------+ 
  9440        |     |     +--- s += Token-&gt;OrgStr;
              |     |   +-+---+ 
  9441        |     |   |  }  | 
              |     |   +-----+ 
              |   +-+---+ 
  9442        |   |  }  | 
              |   +-----+ 
              |  +--------------------------------+ 
  9443        +--+ if((s != &quot;&quot;)&amp;&amp;(s[1] == ' ')){  | 
              |  +--+-----------------------------+ 
  9444        |     +--- s = OffsetStr + s;
              |   +-+---+ 
  9445        |   |  }  | 
              |   +-----+ 
  9446        +--- s = SepLongStr(s);
  9447        +--- fprintf(fp,&quot;%s\n&quot;,s.c_str());
              |  +----------------+ 
  9448        +--+ return TokPos; | 
              |  +----------------+ 
            +-+---+ 
  9449      |  }  | 
            +-----+ 
</pre>


</body>
</html>

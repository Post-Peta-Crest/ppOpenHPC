# Makefile for seism3d3n

include Makefile.option
include Makefile.code

TARGET = ./seism3d3n

SRC   = $(CODE_STDIO) \
	$(CODE_OUTPUT) \
	$(CODE_CONDITION) \
	$(CODE_PARAMS) \
	$(CODE_SOURCE) \
	$(CODE_SOURCE_TF) \
	$(CODE_SURFBC) \
	$(CODE_BOUNDARY) \
	$(CODE_OAT_STATIC) \
	$(CODE_OAT_DYNAMIC) \
	$(CODE_OAT_CONTL) \
	$(CODE_KERNEL_V) \
	$(CODE_KERNEL_S) \
	$(CODE_DIF) \
	$(CODE_OAT_INSTALL)



OBJS = $(SRC:.f90=.o)
OBJ_OAT_INSTALL = $(CODE_OAT_INSTALL:.f90=.o)
OBJ_OAT_STATIC = $(CODE_OAT_STATIC:.f90=.o)
OBJ_OAT_DYNAMIC = $(CODE_OAT_DYNAMIC:.f90=.o)
OBJ_OAT_CONTL = $(CODE_OAT_CONTL:.f90=.o)
OBJ_STDIO = $(CODE_STDIO:.f90=.o)
OBJ_OUTPUT = $(CODE_OUTPUT:.f90=.o)
OBJ_CONDITION = $(CODE_CONDITION:.f90=.o)
OBJ_PARAMS = $(CODE_PARAMS:.f90=.o)
OBJ_KERNEL_V = $(CODE_KERNEL_V:.f90=.o)
OBJ_KERNEL_S = $(CODE_KERNEL_S:.f90=.o)
OBJ_DIF = $(CODE_DIF:.f90=.o)
OBJ_SOURCE = $(CODE_SOURCE:.f90=.o)
OBJ_SOURCE_TF = $(CODE_SOURCE_TF:.f90=.o)
OBJ_SURFBC = $(CODE_SURFBC:.f90=.o)
OBJ_BOUNDARY = $(CODE_BOUNDARY:.f90=.o)
OBJ_TARGET = $(CODE_MAIN:.f90=.o)

.SUFFIXES: 
.SUFFIXES: .f90 .f .o

.f90.o:
	$(FC) -c $(FFLAGS) $< -o $@ 

all: $(TARGET)

$(TARGET): $(OBJS) $(OBJ_TARGET)
	$(FC) -o $(TARGET) $(FFLAGS) $(OBJS) $(OBJ_TARGET)

clean:
	rm -f *.o *.mod $(TARGET) ./OAT/*.o ./OAT/*.mod
distclean:
	rm -f *.o *.mod $(TARGET) ./OAT/*.o ./OAT/*.mod

$(OBJ_TARGET): $(OBJS) $(CODE_MAIN)
$(OBJ_OAT_INSTALL): $(CODE_OAT_INSTALL) 
$(OBJ_OAT_STATIC): $(CODE_OAT_STATIC)
$(OBJ_OAT_DYNAMIC): $(CODE_OAT_DYNAMIC)
$(OBJ_OAT_CONTL): $(CODE_OAT_CONTL) $(OBJ_OAT_INSTALL) $(OBJ_OAT_STATIC) $(OBJ_OAT_DYNAMIC)
$(OBJ_STDIO): $(CODE_STDIO)
$(OBJ_PARAMS): $(CODE_PARAMS) $(OBJ_STDIO)
$(OBJ_SOURCE_TF): $(CODE_SOURCE_TF) $(OBJ_STDIO)
$(OBJ_OUTPUT): $(CODE_OUTPUT) $(OBJ_STDIO) $(OBJ_PARAMS) $(OBJ_SOURCE_TF)
$(OBJ_DIF): $(CODE_DIF) $(OBJ_STDIO) $(OBJ_OAT_CONTL) $(OBJ_OAT_INSTALL)
$(OBJ_BOUNDARY): $(CODE_BOUNDARY) $(OBJ_STDIO) $(OBJ_PARAMS)
$(OBJ_KERNEL_S): $(CODE_KERNEL_S) $(OBJ_STDIO) $(OBJ_PARAMS) $(OBJ_OAT_CONTL) $(OBJ_OAT_INSTALL)  
$(OBJ_KERNEL_V): $(CODE_KERNEL_V) $(OBJ_STDIO) $(OBJ_PARAMS) $(OBJ_OAT_CONTL) $(OBJ_OAT_INSTALL)
$(OBJ_SOURCE): $(CODE_SOURCE) $(OBJ_STDIO) $(OBJ_PARAMS)
$(OBJ_SURFBC): $(CODE_SURFBC) $(OBJ_STDIO) $(OBJ_PARAMS)
$(OBJ_CONDITION): $(CODE_CONDITION) $(OBJ_STDIO) $(OBJ_PARAMS)

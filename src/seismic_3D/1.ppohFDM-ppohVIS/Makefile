# Makefile for seism3d with the ppOpen-MAHT/VIS
include ../../../Makefile.in
include Makefile.code

FLDFLAGS = -L $(LIBDIR)
LIBS     = -lfppohvisfdm3d -lppohvisfdm3d

.SUFEIXES: 
.SUFFIXES: .f90 .f .o

.f90.o:
	$(FC) -c $(FFLAGS) -I. -I $(INCDIR) $< -o $@ 

TARGET = ./seism3d3n

SRC   = $(CODE_STDIO) \
	$(CODE_OUTPUT) \
	$(CODE_CONDITION) \
	$(CODE_PARAMS) \
	$(CODE_KERNEL_V) \
	$(CODE_KERNEL_S) \
	$(CODE_DIF) \
	$(CODE_SOURCE) \
	$(CODE_SOURCE_TF) \
	$(CODE_SURFBC) \
	$(CODE_BOUNDARY)

OBJS = $(SRC:.f90=.o)

OBJ_STDIO = $(CODE_STDIO:.f90=.o)
OBJ_OUTPUT = $(CODE_OUTPUT:.f90=.o)
OBJ_CONDITION = $(CODE_CONDITION:.f90=.o)
OBJ_PARAMS = $(CODE_PARAMS:.f90=.o)
OBJ_KERNEL_V = $(CODE_KERNEL_V:.f90=.o)
OBJ_KERNEL_S = $(CODE_KERNEL_S:.f90=.o)
OBJ_DIF = $(CODE_DIF:.f90=.o)
OBJ_SOURCE = $(CODE_SOURCE:.f90=.o)
OBJ_SOURCE_TF = $(CODE_SOURCE_TF:.f90=.o)
OBJ_SURFBC = $(CODE_SURFBC:.f90=.o)
OBJ_BOUNDARY = $(CODE_BOUNDARY:.f90=.o)
OBJ_TARGET = $(CODE_MAIN:.f90=.o)

all: $(TARGET)

$(TARGET): $(OBJS) $(OBJ_TARGET)
	$(FC) -o $(TARGET) $(FFLAGS) -I $(INCDIR) $(OBJS) $(OBJ_TARGET) $(LIBS) $(FLDFLAGS)

clean:
	rm -f *.o *.mod $(TARGET) *~
distclean:
	rm -f *.o *.mod $(TARGET)

$(OBJ_TARGET): $(OBJS) $(CODE_MAIN)
$(OBJ_STDIO): $(CODE_STDIO)
$(OBJ_PARAMS): $(CODE_PARAMS) $(OBJ_STDIO)
$(OBJ_SOURCE_TF): $(CODE_SOURCE_TF) $(OBJ_STDIO)
$(OBJ_OUTPUT): $(CODE_OUTPUT) $(OBJ_STDIO) $(OBJ_PARAMS) $(OBJ_SOURCE_TF)
$(OBJ_DIF): $(CODE_DIF) $(OBJ_STDIO)
$(OBJ_BOUNDARY): $(CODE_BOUNDARY) $(OBJ_STDIO) $(OBJ_PARAMS)
$(OBJ_KERNEL_S): $(CODE_KERNEL_S) $(OBJ_STDIO) $(OBJ_PARAMS) 
$(OBJ_KERNEL_V): $(CODE_KERNEL_V) $(OBJ_STDIO) $(OBJ_PARAMS) 
$(OBJ_SOURCE): $(CODE_SOURCE) $(OBJ_STDIO) $(OBJ_PARAMS)
$(OBJ_SURFBC): $(CODE_SURFBC) $(OBJ_STDIO) $(OBJ_PARAMS)
$(OBJ_CONDITION): $(CODE_CONDITION) $(OBJ_STDIO) $(OBJ_PARAMS)
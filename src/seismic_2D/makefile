# Makefile for seism2d_psv

include makefile.option
include makefile.code

TARGET = ./seism2d_psv

SRC   = $(CODE_STDLIB) \
	$(CODE_PARAMS) \
	$(CODE_COMVAR) \
	$(CODE_MEDIUM) \
	$(CODE_KERNEL) \
	$(CODE_SURFBC) \
	$(CODE_SOURCE) \
	$(CODE_ABSORB) \
	$(CODE_OUTPUT) \
	$(CODE_REPORT) \
	$(CODE_SWATCH) \
	$(CODE_AVS)

OBJ = $(SRC:.f90=.o)

OBJ_STDLIB = $(CODE_STDLIB:.f90=.o)
OBJ_PARAMS = $(CODE_PARAMS:.f90=.o)
OBJ_COMVAR = $(CODE_COMVAR:.f90=.o)
OBJ_ABSORB = $(CODE_ABSORB:.f90=.o)
OBJ_KERNEL = $(CODE_KERNEL:.f90=.o)
OBJ_MEDIUM = $(CODE_MEDIUM:.f90=.o)
OBJ_OUTPUT = $(CODE_OUTPUT:.f90=.o)
OBJ_REPORT = $(CODE_REPORT:.f90=.o)
OBJ_SWATCH = $(CODE_SWATCH:.f90=.o)
OBJ_AVS    = $(CODE_AVS:.f90=.o)
OBJ_SURFBC = $(CODE_SURFBC:.f90=.o)
OBJ_SOURCE = $(CODE_SOURCE:.f90=.o)
OBJ_TARGET = $(CODE_MAIN:.f90=.o)


$(TARGET): $(OBJ) $(OBJ_TARGET)
	$(FC) $(FFLAGS) -o $@ $(OBJ) $(OBJ_TARGET)

.SUFFIXES: 
.SUFFIXES: .f90 .f .o

$(OBJ_TARGET): $(OBJ) $(CODE_MAIN)
$(OBJ_STDLIB): $(CODE_STDLIB)
$(OBJ_PARAMS): $(CODE_PARAMS) $(OBJ_STDLIB)
$(OBJ_COMVAR): $(CODE_COMVAR) $(OBJ_STDLIB) $(OBJ_PARAMS)
$(OBJ_KERNEL): $(CODE_KERNEL) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR)
$(OBJ_ABSORB): $(CODE_ABSORB) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR) $(OBJ_KERNEL)
$(OBJ_MEDIUM): $(CODE_MEDIUM) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR)
$(OBJ_SURFBC): $(CODE_SURFBC) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR) $(OBJ_MEDIUM)
$(OBJ_SOURCE): $(CODE_SOURCE) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR)
$(OBJ_OUTPUT): $(CODE_OUTPUT) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR) $(OBJ_MEDIUM) $(OBJ_SOURCE)
$(OBJ_REPORT): $(CODE_REPORT) $(OBJ_STDLIB) $(OBJ_PARAMS) $(OBJ_COMVAR) $(OBJ_SOURCE) $(OBJ_OUTPUT)
$(OBJ_SWATCH): $(CODE_SWATCH) $(OBJ_STDLIB)
$(OBJ_AVS): $(CODE_SWATCH) $(OBJ_STDLIB) $(OBJ_PARAMS)


.f90.o:
	$(FC) $(FFLAGS) -c $< -o $@

clean:
	rm -f seism2d_psv.o $(SRC:.f90=.o) *.mod *~ $(TARGET)

clean2:
	rm -f $(SRC:.f90=.o) *.mod *~
